<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
  <h:head>
    <title>Minha conta - Sizeapp</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link href="http://localhost:8080/SizeApp/src/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" type="text/css" href="http://localhost:8080/SizeApp/src/css/animate.css" />
    <style type="text/css">
      html, body { 
        height: 100%; 
        margin: 0; 
        padding: 0; 
      }
      .img-circle{
        width: 140px;
        height: 140px;
      }
      #imgField{
        margin: 0 auto;
        cursor: pointer;
        transition: all 0.5s ease;
      }
      #imgField:hover{
        opacity: 0.5;
        box-shadow: black 0px 0px 8px 0px;
      }
      .table td{
        vertical-align: middle !important;
      }
      .table{
        margin-top: 20px;
      }
    </style>
  </h:head>
  <h:body>
    <ui:include src="../../src/models/navbarLogged.xhtml" />
    <div class="container-fluid" style="margin-top:50px;">            
      <div class="col-md-8 col-md-offset-2">
        <h1>Minha Conta</h1>
        <div class="panel panel-default">
          <div class="panel-body">
            <ul class="nav nav-tabs">
              <li role="presentation" class="active"><a href="#tab1" data-toggle="tab">Dados Pessoais</a></li>
              <li role="presentation"><a href="#tab2" data-toggle="tab">Atividades</a></li>
              <li role="presentation"><a href="#tab3" data-toggle="tab">Segurança</a></li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane active table-responsive" id="tab1">
                <table class="table table-striped">
                  <tr>
                    <td class="col-md-2">
                      <label>Foto do Perfil</label>
                    </td>                                            
                    <td class="col-md-7">
                      <h:graphicImage id="userPicture" class="img-circle" url="#{UsuarioController.loggedUser.fotoUrl}"/>
                      <h:message id="msg_imgField" for="imgField"/>
                    </td>   
                    <td class="col-md-3">
                      <button class="btn btn-default btn-sm" data-toggle="modal" data-target="#imgChangeModal">Alterar</button>                      
                      <h:form style="display:inline-block"> 
                        <button class="btn btn-danger btn-sm" jsf:action="#{UsuarioController.alterar('foto')}">Remover</button>
                      </h:form>
                    </td>
                  </tr>
                  <tr>
                    <td class="col-md-2">
                      <label>Nome</label>
                    </td>                                            
                    <td class="col-md-7">
                      <h4>#{UsuarioController.loggedUser.nome}</h4>
                    </td> 
                    <td class="col-md-3">
                      <button class="btn btn-default btn-sm" data-toggle="modal" data-target="#nameChangeModal">Alterar</button>
                      <button class="btn btn-danger disabled btn-sm">Remover</button>                      
                    </td>
                  </tr>
                </table>
              </div>
              <div class="tab-pane" id="tab2">
                Em desenvolvimento...
              </div>
              <div class="tab-pane" id="tab3">
                <h:form> 
                  <div class="table-responsive">
                    <table class="table">
                      <tr>
                        <td class="col-md-2">
                          <label>Alterar Senha</label>
                        </td>
                        <td class="col-md-4">
                          <input class="form-control" type="password" jsf:value="#{UsuarioController.usuarioModel.senha}" required="required" title="Sua senha deve ter no mínimo 6 caracteres" pattern=".{6,}"/>
                        </td>
                        <td class="col-md-3">
                          <span>mínimo de 6 caracteres</span>
                        </td>
                        <td class="col-md-3">
                          <h:commandButton class="btn btn-default btn-sm" action="#{UsuarioController.alterar('senha')}" value="Alterar"/>
                          <button class="btn btn-danger disabled btn-sm">Remover</button>      
                        </td>
                      </tr>
                    </table>
                  </div>
                </h:form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal Alterar Foto-->
    <div class="modal fade" id="imgChangeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"></span></button>
            <h4 class="modal-title" id="myModalLabel">Alterar foto</h4>
          </div>
          <h:form prependId="false" enctype="multipart/form-data">
            <div class="modal-body">
              <div class="row text-center">
                <label>Clique na imagem para alterar</label>
              </div>
              <div class="row ">
                <h:graphicImage id="imgField" class="img-circle img-responsive" url="#{UsuarioController.loggedUser.fotoUrl}"/>
              </div>
              <input class="hidden" type="file" id="foto" jsf:value="#{UsuarioController.usuarioModel.foto}"/>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
              <h:commandButton class="btn btn-primary btn-md" id="alterarFoto" action="#{UsuarioController.alterar('foto')}" value="Salvar" >
                <f:ajax execute="@form" render="msg_imgField" />
              </h:commandButton>

              <!--<button type="button" class="btn btn-primary">Salvar</button>-->
            </div>
          </h:form>
        </div>
      </div>
    </div>
    <!--    Modal Alterar Nome-->
    <div class="modal fade" id="nameChangeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel2">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"></span></button>
            <h4 class="modal-title" id="myModalLabel2">Alterar foto</h4>
          </div>
          <h:form prependId="false" enctype="multipart/form-data">
            <div class="modal-body">
              <div class="row text-center">
                <label>Insira seu nome</label>
              </div>
              <div class="row">
                <div class="col-md-8 col-md-offset-2">
                  <input type="text" class="form-control" jsf:value="#{UsuarioController.usuarioModel.nome}" required="required" minlength="2"/>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
              <h:commandButton class="btn btn-primary btn-md" id="alterarNome" action="#{UsuarioController.alterar('nome')}" value="Salvar" />
              <!--<button type="button" class="btn btn-primary">Salvar</button>-->
            </div>
          </h:form>
        </div>
      </div>
    </div>
    <f:metadata>
      <f:event type="preRenderView" listener="#{UsuarioController.showMessage()}" />
    </f:metadata>
  </h:body>

  <script src="../../src/js/jquery.js" type="text/javascript"></script>
  <script src="../../src/js/bootstrap.min.js" type="text/javascript"></script>
  <script src="../../src/js/jquery.toaster.js" type="text/javascript"></script>
  <script src="../../src/js/jquery.toaster.js" type="text/javascript"></script>
  <script src="../../src/js/scripts.js" type="text/javascript"></script>
  <script>
    $(document).ready(function(){
      #{UsuarioController.message.message}
    });
  </script>
</html>
